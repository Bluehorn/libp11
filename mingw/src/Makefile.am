MAINTAINERCLEANFILES = Makefile.in
CLEANFILES = libp11.pc
EXTRA_DIST = Makefile.mak makedef.pl

noinst_HEADERS= libp11-int.h pkcs11.h
include_HEADERS= libp11.h
lib_LTLIBRARIES = libp11.la
pkgconfig_DATA = libp11.pc

libp11_la_SOURCES = libpkcs11.c p11_attr.c p11_cert.c p11_err.c p11_key.c \
	p11_load.c p11_misc.c p11_ops.c p11_rsa.c p11_slot.c \
	libp11.exports
if WIN32
nodist_libp11_la_SOURCES = versioninfo.rc
endif
libp11_la_CFLAGS = $(AM_CFLAGS) $(OPENSSL_CFLAGS) $(LTLIB_CFLAGS)
libp11_la_LIBADD = $(OPENSSL_LIBS) $(LTLIB_LIBS)
libp11_la_LDFLAGS = $(AM_LDFLAGS) \
	-version-info @LIBP11_LT_CURRENT@:@LIBP11_LT_REVISION@:@LIBP11_LT_AGE@ \
	-export-symbols libp11.exports \
	-no-undefined

if WIN32
# def file required for MS users to build library
mylibdir=$(libdir)
if CYGWIN
mylib_DATA=.libs/cygp11-@LIBP11_LT_MAJOR@.dll.def
.libs/cygp11-@LIBP11_LT_MAJOR@.dll.def:	libp11.la
else
mylib_DATA=.libs/libp11-@LIBP11_LT_MAJOR@.dll.def
.libs/libp11-@LIBP11_LT_MAJOR@.dll.def:	libp11.la
endif
endif

RCCOMPILE = $(RC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
	$(AM_CPPFLAGS) $(CPPFLAGS)
LTRCCOMPILE = $(LIBTOOL) --mode=compile --tag=RC $(RCCOMPILE)

.rc.lo:
	$(LTRCCOMPILE) -i $< -o $@

.rc.o:
	$(RCCOMPILE) -i $< -o $@

